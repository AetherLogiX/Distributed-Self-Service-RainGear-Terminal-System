# 数据库连接问题解决方案

## 问题原因
Qt的QMYSQL驱动需要两个文件：
1. `qsqlmysql.dll` - Qt的MySQL插件
2. `libmysql.dll` - MySQL客户端库

## 已完成的修复

### 1. 文件部署
- ✅ `qsqlmysql.dll` 已复制到 `build/qt-release/plugins/sqldrivers/`
- ✅ `libmysql.dll` 已复制到 `build/qt-release/`
- ✅ 所有必需的Qt和MinGW运行时DLL已在build目录

### 2. 代码修复
- ✅ `client/main.cpp` 已更新，添加了插件路径设置
- ✅ 添加了详细的调试信息输出

## 使用步骤

### 方法1：直接运行（推荐）
1. **关闭当前运行的程序**（如果还在运行）
2. 进入build目录：
   ```powershell
   cd "C:\Users\hdcqW\Desktop\IoT Self-Service Umbrella Terminal\build\qt-release"
   ```
3. 运行程序：
   ```powershell
   .\rainhub_client.exe
   ```

### 方法2：重新编译后运行
1. **关闭当前运行的程序**
2. 重新编译：
   ```powershell
   cd "C:\Users\hdcqW\Desktop\IoT Self-Service Umbrella Terminal"
   cmake --build build/qt-release --config Release
   ```
3. 运行程序：
   ```powershell
   .\build\qt-release\rainhub_client.exe
   ```

## 验证数据库连接

程序启动后，在终端会看到：
```
[Main] Application dir: ...
[Main] Plugin path 1 (plugins): ... true
[Main] Plugin path 2 (sqldrivers): ... true
[Main] Available SQL drivers: ("QIBASE", "QSQLITE", "QMIMER", "QMARIADB", "QMYSQL", ...)
```

如果看到 `QMYSQL` 在可用驱动列表中，说明插件加载成功！

## 数据库配置

默认连接参数（可在代码中修改）：
- Host: 127.0.0.1
- Port: 3306
- Database: rain_gear_db
- User: root
- Password: 123456

## 如果还有问题

1. 检查MySQL服务是否运行：
   ```powershell
   Get-Service | Where-Object {$_.DisplayName -like "*MySQL*"}
   ```

2. 检查数据库是否存在：
   ```powershell
   mysql -u root -p123456 -e "SHOW DATABASES LIKE 'rain_gear_db';"
   ```

3. 检查表是否存在：
   ```powershell
   mysql -u root -p123456 rain_gear_db -e "SHOW TABLES LIKE 't_user';"
   ```

4. 查看程序输出的调试信息，确认插件路径和驱动列表

